(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{447:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"小程序分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序分析"}},[t._v("#")]),t._v(" 小程序分析")]),t._v(" "),a("h2",{attrs:{id:"小程序与普通网页开发的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序与普通网页开发的区别"}},[t._v("#")]),t._v(" 小程序与普通网页开发的区别")]),t._v(" "),a("p",[t._v("小程序的主要开发语言是 JavaScript ，小程序的开发同普通的网页开发相比有很大的相似性。对于前端开发者而言，从网页开发迁移到小程序的开发成本并不高，但是二者还是有些许区别的。")]),t._v(" "),a("p",[t._v("网页开发渲染线程和脚本线程是互斥的，这也是为什么长时间的脚本运行可能会导致页面失去响应，而在小程序中，二者是分开的，分别运行在不同的线程中。网页开发者可以使用到各种浏览器暴露出来的 DOM API，进行 DOM 选中和操作。而如上文所述，小程序的逻辑层和渲染层是分开的，逻辑层运行在 JSCore 中，并没有一个完整浏览器对象，因而缺少相关的DOM API和BOM API。这一区别导致了前端开发非常熟悉的一些库，例如 jQuery、 Zepto 等，在小程序中是无法运行的。同时 JSCore 的环境同 NodeJS 环境也是不尽相同，所以一些 NPM 的包在小程序中也是无法运行的。")]),t._v(" "),a("p",[t._v("网页开发者需要面对的环境是各式各样的浏览器，PC 端需要面对 IE、Chrome、QQ浏览器等，在移动端需要面对Safari、Chrome以及 iOS、Android 系统中的各式 WebView 。而小程序开发过程中需要面对的是两大操作系统 iOS 和 Android 的微信客户端，以及用于辅助开发的小程序开发者工具，小程序中三大运行环境也是有所区别的")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("运行环境")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("逻辑层")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("渲染层")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("iOS")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("JavaScriptCore")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("WKWebView")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("安卓")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("V8")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("chromium定制内核")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("小程序开发者工具")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("NWJS")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Chrome WebView")])])])]),t._v(" "),a("p",[t._v("网页开发者在开发网页的时候，只需要使用到浏览器，并且搭配上一些辅助工具或者编辑器即可。小程序的开发则有所不同，需要经过申请小程序帐号、安装小程序开发者工具、配置项目等等过程方可完成。")]),t._v(" "),a("h2",{attrs:{id:"文章分享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文章分享"}},[t._v("#")]),t._v(" 文章分享")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://chris118.github.io/2018/04/10/2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("小程序架构"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://eux.baidu.com/blog/fe/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信小程序架构原理"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://zhaomenghuan.js.org/blog/what-is-emp.html#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84",target:"_blank",rel:"noopener noreferrer"}},[t._v("基于vuejs的小程序引擎底层框架实现"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://zhaomenghuan.js.org/note/miniprogram/awesome-miniprogram.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("小程序原理等文章"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"拓展"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拓展"}},[t._v("#")]),t._v(" 拓展")]),t._v(" "),a("p",[t._v("Flutter 自己实现了一套渲染机制")]),t._v(" "),a("p",[t._v("小程序是语言层面的")]),t._v(" "),a("h2",{attrs:{id:"思维引导"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思维引导"}},[t._v("#")]),t._v(" 思维引导")]),t._v(" "),a("p",[a("strong",[t._v("首先我们看看小程序代码的组成部分")])]),t._v(" "),a("p",[t._v("js 开发逻辑代码  ==> js   ==>v8")]),t._v(" "),a("p",[t._v("wxss 控制小程序样式  ==>css(浏览器渲染器) ==>  css")]),t._v(" "),a("p",[t._v("wxml    xml  控制渲染层展示  ==>html(浏览器渲染器)==>dom")]),t._v(" "),a("p",[a("strong",[t._v("我们需要思考一个问题：")])]),t._v(" "),a("p",[t._v("wxss wxml 自己实现了一套渲染解析器还是使用了预编译技术？？   ===>html css")]),t._v(" "),a("h2",{attrs:{id:"基本架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本架构"}},[t._v("#")]),t._v(" 基本架构")]),t._v(" "),a("p",[t._v("原因：是对浏览器部分进行的优化，浏览器解析网页的时候是单线程的阻塞式的。")]),t._v(" "),a("p",[t._v("小程序主要分为"),a("strong",[t._v("逻辑层")]),t._v("和"),a("strong",[t._v("视图层")]),t._v("，还有就是他们的原生部分。这样组成了小程序的双线程架构，逻辑层加载js ，渲染层加载wxml、wxss==>iframe。通过JSBridge进行消息通信，只传输字符串类型的数据，例如点击事件会传输事件名。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/structure.png",alt:"structure"}})]),t._v(" "),a("ul",[a("li",[a("p",[t._v("视图层主要负责页面的渲染")])]),t._v(" "),a("li",[a("p",[t._v("逻辑层负责js的执行。")])])]),t._v(" "),a("p",[t._v("他们之间通过event和data来通信。通信是有微信客户端（native）做的一层中转；")]),t._v(" "),a("p",[t._v("然后也可以通过jsBridge来调用原生的api，比如什么相机、扫码等功能。")]),t._v(" "),a("p",[t._v("这个视图层，最后我们打包出来的代码，就是html和css，在这里面运行，视图层目前使用 WebView 作为渲染载体。")]),t._v(" "),a("p",[t._v("逻辑层是由独立的 JsCore 作为js的运行环境,所以他和浏览器不一样，只有一些js对应的方法，不能直接操作dom和获取dom，中间都需要通信这一层中转，在架构上，WebView 和 JavascriptCore 都是独立的模块，并不具备数据直接共享的通道。")]),t._v(" "),a("p",[t._v("当前，视图层和逻辑层的数据传输，实际上通过两边提供的 "),a("code",[t._v("evaluateJavascript")]),t._v(" 所实现。")]),t._v(" "),a("p",[t._v("即用户传输的数据，需要将其转换为字符串形式传递，同时把转换后的数据内容拼接成一份 JS 脚本，再通过执行 JS 脚本的形式传递到两边独立环境。")]),t._v(" "),a("p",[t._v("而 "),a("code",[t._v("evaluateJavascript")]),t._v(" 的执行会受很多方面的影响，数据到达视图层并不是实时的。")]),t._v(" "),a("p",[t._v("由于这之间他们是彼此独立的，是基于消息驱动来渲染的，所以不会阻塞页面；")]),t._v(" "),a("p",[t._v("所以这就不会造成渲染的阻塞，我的渲染不会影响你的js逻辑，js的执行也不会柱塞渲染的过程；")]),t._v(" "),a("p",[t._v("比如你在发送一些请求的时候，这种一般是经由native转发；")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/basicStructure.png",alt:"basicStructure"}})]),t._v(" "),a("h2",{attrs:{id:"查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看"}},[t._v("#")]),t._v(" 查看")]),t._v(" "),a("h3",{attrs:{id:"打开调试工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打开调试工具"}},[t._v("#")]),t._v(" 打开调试工具")]),t._v(" "),a("p",[t._v("微信开发者工具 ==> 左上角 调试--》调试微信开发者工具")]),t._v(" "),a("p",[a("strong",[t._v("查看页面")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementsByTagName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webview'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showDevTools")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("strong",[t._v("查看逻辑层")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603266403016_85AC96F4-C7E1-4F7F-BDAE-191375A9F1FA.png",alt:"1603266403016_85AC96F4-C7E1-4F7F-BDAE-191375A9F1FA"}})]),t._v(" "),a("p",[t._v("整个小程序--\x3e 只有一个逻辑层--\x3e装载所有页面逻辑js")]),t._v(" "),a("p",[t._v("视图层（渲染）==>一个页面---\x3e一个webview（wxml、wxss）")]),t._v(" "),a("h3",{attrs:{id:"小程序限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序限制"}},[t._v("#")]),t._v(" 小程序限制")]),t._v(" "),a("p",[t._v("小程序刚出来时候有限制5个层级，这是因为只维护了5层。现在是10层。")]),t._v(" "),a("h2",{attrs:{id:"基础库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础库"}},[t._v("#")]),t._v(" 基础库")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603266687632_3CF9F2DB-28DA-49DB-8554-9261F114F86D.png",alt:"1603266687632_3CF9F2DB-28DA-49DB-8554-9261F114F86D"}})]),t._v(" "),a("h3",{attrs:{id:"查看-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看-2"}},[t._v("#")]),t._v(" 查看")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603266794627_D5DDEB42-C471-45EB-9195-5229B47CCA27.png",alt:"1603266794627_D5DDEB42-C471-45EB-9195-5229B47CCA27"}})]),t._v(" "),a("h3",{attrs:{id:"小程序底层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序底层"}},[t._v("#")]),t._v(" 小程序底层")]),t._v(" "),a("p",[t._v("小程序开发者工具  openVendor==> 基础库（对于底层运行时的封装、提供事件、数据变更、通信、基础函数）")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603266951035_76BEFD4C-4205-46F1-9E0D-CF05E6583D2C.png",alt:"1603266951035_76BEFD4C-4205-46F1-9E0D-CF05E6583D2C"}})]),t._v(" "),a("p",[t._v("基础库==>wxappUnpacker==>破解.wxvpkg文件，查看源码(比较难读)")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603267418231_B6E4E86E-17AA-4266-8306-80CCF868E056.png",alt:"1603267418231_B6E4E86E-17AA-4266-8306-80CCF868E056"}})]),t._v(" "),a("h2",{attrs:{id:"源码解读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码解读"}},[t._v("#")]),t._v(" 源码解读")]),t._v(" "),a("h3",{attrs:{id:"视图层引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视图层引擎"}},[t._v("#")]),t._v(" 视图层引擎")]),t._v(" "),a("p",[t._v("WAWebview.js  ==>视图层引擎")]),t._v(" "),a("blockquote",[a("p",[t._v("Foundation 基础模块\n提供环境变量env isService isWebview  eventEmit  jsbridge ready监听 配置")])]),t._v(" "),a("blockquote",[a("p",[t._v("WeixinJSBridge 消息通信机制")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603268130898_BCC606C0-4253-418F-AF98-E60CA805CE6C.png",alt:"1603268130898_BCC606C0-4253-418F-AF98-E60CA805CE6C"}})]),t._v(" "),a("p",[t._v("NativeBuffer 转换数据格式")]),t._v(" "),a("p",[t._v("Reporter 日志系统")]),t._v(" "),a("p",[a("strong",[t._v("exparser 组件系统")])]),t._v(" "),a("ol",[a("li",[t._v("shadomDOM  （WebComponet规范）例子 wx-element")]),t._v(" "),a("li",[t._v("提供友好交互的组件  承接原生")]),t._v(" "),a("li",[t._v("video 原生的组件  事件系统")]),t._v(" "),a("li",[t._v("wxml")]),t._v(" "),a("li",[t._v("picker")]),t._v(" "),a("li",[t._v("slider")]),t._v(" "),a("li",[t._v("swiper")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exparser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerBehavior")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  is"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wx-class-prefix"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("created")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_classPrefix "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ownerShadowRoot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPrefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_classPrefix "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_addGlobalClass "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAddOriginalClass")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  methods"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("convertClassListWithPrefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getClassPrefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAddGlobalClass")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" o "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" o "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" o"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("convertClassWithPrefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getClassPrefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAddGlobalClass")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" e\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getClassPrefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_classPrefix\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getAddGlobalClass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_addGlobalClass\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br")])]),a("p",[a("strong",[a("strong",[t._v("virtualDOM")])])]),t._v(" "),a("h3",{attrs:{id:"逻辑层引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#逻辑层引擎"}},[t._v("#")]),t._v(" 逻辑层引擎")]),t._v(" "),a("p",[t._v("WAService.js  ==>")]),t._v(" "),a("blockquote",[a("p",[t._v("foundation 基础模块\n提供环境变量env isService isWebview  eventEmit  jsbridge ready监听 配置")])]),t._v(" "),a("blockquote",[a("p",[t._v("WeixinJSBridge 消息通信机制")])]),t._v(" "),a("p",[t._v("​    路由管理\n​    生命周期管理\n​    "),a("strong",[a("strong",[a("strong",[t._v("subContextEngine")])])]),t._v("__: App、Page、component  getApp"),a("br"),t._v("\n​    __"),a("strong",[a("strong",[t._v("virtualDOM")])])]),t._v(" "),a("blockquote",[a("p",[t._v("逻辑层维护了一套______virtualDOM______ 是为了可以选择节点，createSelectorQuery这个方法，中间还处理了时间的分发等等。")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("createSelectorQuery"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" __appServiceSDK__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_createSelectorQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("me")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("we")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("in")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("J")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createSelectorQuery"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("h2",{attrs:{id:"编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[t._v("#")]),t._v(" 编译")]),t._v(" "),a("h3",{attrs:{id:"wcc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wcc"}},[t._v("#")]),t._v(" wcc")]),t._v(" "),a("p",[t._v("Wechat WXML Compiler ==> wxml编译器==> js")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("初始化，执行js，生成构建虚拟dom的函数(渲染器)")])]),t._v(" "),a("li",[a("p",[t._v("数据传递给 虚拟dom的函数==>vDOM描述")])]),t._v(" "),a("li",[a("p",[t._v("vDOM描述==>exparser==>解析 ==>构建真实dom")])]),t._v(" "),a("li",[a("p",[t._v("数据变更 2-3->diff--\x3e渲染")])])]),t._v(" "),a("h3",{attrs:{id:"wcsc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wcsc"}},[t._v("#")]),t._v(" wcsc")]),t._v(" "),a("p",[t._v("WeChat Stylesheet Compiler ==>wxss编译器==>js")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("wxss ==>js (把rpx单位处理，处理成函数)")])]),t._v(" "),a("li",[a("p",[t._v("获取手机物理及像素分辨力来计算应该多少，")])]),t._v(" "),a("li",[a("p",[t._v("生成新的style 插入")])])]),t._v(" "),a("h2",{attrs:{id:"初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[t._v("#")]),t._v(" 初始化")]),t._v(" "),a("h3",{attrs:{id:"渲染层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染层"}},[t._v("#")]),t._v(" 渲染层")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("初始化_webviewId_、wxCode_")])]),t._v(" "),a("li",[a("p",[t._v("加载生成渲染器方法的代码（wxml==>js）")])]),t._v(" "),a("li",[a("p",[t._v("加载执行 wxss==>js ()==>生成css")])]),t._v(" "),a("li",[a("p",[t._v("初始化页面配置")])]),t._v(" "),a("li",[a("p",[t._v("$gwx==>generateFunc(渲染器==>VDOM)，需要数据")])])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CustomEvent/CustomEvent",target:"_blank",rel:"noopener noreferrer"}},[t._v("自定义事件"),a("OutboundLink")],1)]),t._v(" "),a("ol",{attrs:{start:"6"}},[a("li")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" generateFunc "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$gwx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("decodeName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("generateFunc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CustomEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatchEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"generateFuncReady"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    detail"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      generateFunc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" generateFunc\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerText "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" decodeName "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" not found"')]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("decodeName "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" not found"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("p",[t._v("generateFuncReady  基础库的方法")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//基础库源代码")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n1. 定义generateFuncReady，渲染成已经获取到wxml，通过$gwx编译成生成函数\n2. webView渲染层触发dispatch(new Custom('generateFuncReady',detail:$gwx('...')))\n*/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("generateFuncReady")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" arguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//判断是否WeixinJSBridge准备完成，")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("r")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//触发WeixinJSBridge")]),t._v("\n        WeixinJSBridge"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("publish")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WeixinJSBridge"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("o")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GenerateFuncReady"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"generateFuncReady"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" generateFuncReady"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])]),a("ol",{attrs:{start:"7"}},[a("li",[a("p",[t._v("??generateFuncReady ==>generateFunc（）==>VDOM")])]),t._v(" "),a("li",[a("p",[t._v("如果，这中间再发生什么变化，触发了setData，这个时候就会重新调用我们刚刚的虚拟dom生成方法，然后在对应的webview层的基础代码来触发dom diff的过程；")])])]),t._v(" "),a("h3",{attrs:{id:"逻辑层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#逻辑层"}},[t._v("#")]),t._v(" 逻辑层")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("初始化配置项 页面配置 全局 路由")])]),t._v(" "),a("li",[a("p",[t._v("加载逻辑层基础库 （Page、App、Component、wx.getSetting.wx.scanCode）")])]),t._v(" "),a("li",[a("p",[t._v("加载所有页面的配置和渲染器方法")])])]),t._v(" "),a("p",[a("strong",[t._v("查看方式")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603354233179_D854485F-6BD6-4586-BBB7-82550C4FD5A0.png",alt:"1603354233179_D854485F-6BD6-4586-BBB7-82550C4FD5A0"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603354423405_EC87D663-4FD6-42FD-B360-15CC8B7A0A4A.png",alt:"1603354423405_EC87D663-4FD6-42FD-B360-15CC8B7A0A4A"}})]),t._v(" "),a("h2",{attrs:{id:"流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#流程"}},[t._v("#")]),t._v(" 流程")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/%E6%B5%81%E7%A8%8B%E5%9B%BE.png",alt:"流程图"}})]),t._v(" "),a("h2",{attrs:{id:"小程序框架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序框架"}},[t._v("#")]),t._v(" 小程序框架")]),t._v(" "),a("h3",{attrs:{id:"为什么有小程序框架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么有小程序框架"}},[t._v("#")]),t._v(" 为什么有小程序框架")]),t._v(" "),a("p",[t._v("一开始小程序才出来的时候，他的定义了一个不论不类的语法、原生开发对于预编译器和webpack都支持不会，对于开发效率和工程构建流程都不方便；还有就是他这个ide确实和专业的ide比起来，实在不好用；")]),t._v(" "),a("p",[t._v("所以就出来了用vue和react相关的语法来开发，这样也没有再去搞个新的写法，还有就是vue和react周边的生态也比较多，有很多相关的工具和第三方库，所以就衍生了一系列框架；")]),t._v(" "),a("p",[t._v("一开始小程序才出来的时候，他的定义了一个不论不类的语法、原生开发对于预编译器和webpack都支持不会，对于开发效率和工程构建流程都不方便；还有就是他这个ide确实和专业的ide比起来，实在不好用；")]),t._v(" "),a("p",[t._v("所以就出来了用vue和react相关的语法来开发，这样也没有再去搞个新的写法，还有就是vue和react周边的生态也比较多，有很多相关的工具和第三方库，所以就衍生了一系列框架；")]),t._v(" "),a("h3",{attrs:{id:"编译时框架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译时框架"}},[t._v("#")]),t._v(" 编译时框架")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("wepy")])])]),t._v(" "),a("p",[t._v("这个是比较早的框架了，通过一些预编译的手段来开发，他的风格就和vue和写法就和vue差不多，不过他这个还是一种编译的语言，这个是腾讯早起开发的；什么是预编译呢，就是把对应的语法编译成AST抽象语法树，然后通过一些规则来处理成为小程序对应的运行的语言，这个一会儿详细聊一下")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("taro")])])]),t._v(" "),a("p",[t._v("这个也是比较早的框架，它相对来说和wepy大致差不多，一个是类vue的语法，一个是京东自己的类react框架nervjs，所以写法相对来说比较偏react，所以用的比较多，还有就是它的目标是多端、web、小程序、rn，目前rn相对来说，可以支持，但是中间还是需要做很多处理，很多写法上的约束，比如说rn你在写样式的时候，就需要把对应的样式处理到js里面来生成对象，并且只支持flex，所以这个相对而言就玩起来没那么嗨，现在写app，flutter不香么")]),t._v(" "),a("p",[t._v("taro对于你的命令行传递的参数，来编译成对应端的代码；不同端的代码，有不同的编译过程，大致流程和思路就是这样，这个我们下节课会给大家详细分析")]),t._v(" "),a("h3",{attrs:{id:"半编译半运行框架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#半编译半运行框架"}},[t._v("#")]),t._v(" 半编译半运行框架")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("mpvue")])])]),t._v(" "),a("p",[t._v("因为taro和wepy这两个框架都是采用的静态编译的方式，把我们写的代码，解析成为抽象语法树，然后通过语法分析把代码转换为可以运行在小程序的代码。比如我们写taro的时候，他就把代码编译成小程序代码，然后把render方法里面的jsx提取出来，编译成小程序的静态模板，js就处理为小程序的页面的一些生命周期，但是对于js这种语言本来就是一种动态语言，编译成为静态的方式，就会有很多的写法和使用限制，毕竟要写对应的解析规则来处理特定的语法；")]),t._v(" "),a("p",[t._v("比如这种语法（大致写一下，可以打开对应的这个模板taro加油项目尝试一下），taro就不认；所以就需要换一种思路来看整个生态，所以就出来了mpvue；")]),t._v(" "),a("p",[t._v("这个就完全是基于vue的语法来开发，它是把vue的库直接给fork过来的，对于我们现在市面上的vue和react的一个大结构，主要就是分成runtime运行时，还有就是compilier编译时，运行时就是真正的框架的运行的流程，但是真正的视图展现还是在端上面（可能是web端、客户端、小程序端），所以mpvue就是保留了vue的运行时的机制，但是对于模板这一层他做的思路和taro的思路大致相同，可以大致"),a("a",{attrs:{href:"https://github.com/Meituan-Dianping/mpvue",target:"_blank",rel:"noopener noreferrer"}},[t._v("看一下"),a("OutboundLink")],1),t._v("他的源码结构；增加了端的代码和编译的一下方式，大致看一下packages里面的几个包，这几个就是对应的编译vue的单组件（SFC）到小程序的端代码；")]),t._v(" "),a("p",[t._v("这块主要是vue的模板风格和小程序的模板风格比较相同，那么这块工作量就比较少：")]),t._v(" "),a("p",[t._v("就如同这样编译到对应的模板；")]),t._v(" "),a("p",[t._v("真正运行的时候，我们知道vue的运行过程是什么样子的：")]),t._v(" "),a("ul",[a("li",[t._v("我们在本地编译的时候，会把对应的模板生成一段render函数，调用render函数就会生成虚拟的dom；虚拟dom对应到真实的dom，就是VNode。")]),t._v(" "),a("li",[t._v("虚拟dom出来了之后，如果发生了更改，内部就会有一个patch diff的过程来比较更新的地方，然后调用修改真实dom的方法")]),t._v(" "),a("li",[t._v("在vue实例化的时候，会监听Data数据，如果数据变更，就触发render，最后也来调用patch")])]),t._v(" "),a("p",[t._v("在mpVue里面它做了什么呢？就是重写了patch的方法，不去操作对应的dom，因为在小程序中，原生要触发视图更新，就需要调用setData，所以patch的阶段就会重写成为调用setData的方法；")]),t._v(" "),a("p",[t._v("在初始化 new Vue的时候，还会触发调用Page()的方法，来生成小程序的页面实例；所以在patch的时候，拿到对应页面的数据，diff完成了之后，调用setData；")]),t._v(" "),a("p",[t._v("所以这一层是不是就回到了我们昨天聊的优化了，在逻辑层先diff一遍，只把真正修改的数据setData过去")]),t._v(" "),a("p",[t._v("可以看一下大致的文件结构：")]),t._v(" "),a("p",[a("strong",[t._v("packages/mpvue-template-compiler")]),t._v("    提供了将 vue 的模板语法转换到小程序的 wxml 语法的能力，它只要涉及到模板的预先编译，他这块都会有一些js动态执行模板的过程就不支持，因为编译的语法，一开始没有写定；")]),t._v(" "),a("p",[a("strong",[t._v("mpvue")]),t._v(" 提供了所有的运行时的处理机制；")]),t._v(" "),a("p",[t._v("我们可以看一下build/config.js，这里面有对应的配置；")]),t._v(" "),a("p",[t._v("我们可以找到对应mpvue对应的是结构就是在platforms/mp/runtime;")]),t._v(" "),a("p",[t._v("lifecycle可以看到对应的生命周期的映射")]),t._v(" "),a("p",[t._v("render 可以看到两个点：")]),t._v(" "),a("ul",[a("li",[t._v("使用了一个节流的过程来优化setData的评率")]),t._v(" "),a("li",[t._v("updateDataToMP 在setData之前，触发一个diff的过程；")]),t._v(" "),a("li",[t._v("这里面都可以详细看一下")])]),t._v(" "),a("p",[t._v("patch这个概念在vue中，你可以暂时理解为定向更新某一个dom，所以这块他就是通过SetData的过程来更新到view层；")]),t._v(" "),a("h3",{attrs:{id:"运行时框架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行时框架"}},[t._v("#")]),t._v(" 运行时框架")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("remax")])])]),t._v(" "),a("p",[t._v("这个mpvue的思路呢，整体来说算是半编译、半运行时，因为真正的模板还是通过编译的过程得来的，只是在运行的时候，保留了vue的运行时，taro就完全的直接是小程序的运行时了，所以又出来了一种新思路。")]),t._v(" "),a("p",[t._v("​\t我们平时在写react的时候，调用渲染的时候，都是调用的reactDOM.render，这个ReactDOM叫做渲染器，它是把虚拟的Dom转换为对应平台的真实元素上去，ReactDOM就是把虚拟dom转换为web的dom，当然针对还有rn的渲染器，社区里面还有一些对于其他平台的渲染器，这个时候如果添加一个小程序的渲染器，是不是就可以实现用react开发了；")]),t._v(" "),a("p",[t._v("但是小程序是没有dom的，所以这块remax引入了一个VNode的抽象层，先把对应的虚拟dom映射到VNode上，然后把VNode转换为小程序页面的data，然后把data转为页面，VNode和dom结构有点像，虚拟dom知识描述节点的样子，但是VNode包含了什么节点的类型呀，属性、子节点，还有什么新增、删除、插入节点等方法，大致的结构就如同这样的：")]),t._v(" "),a("p",[t._v("这个时候，把整个运行时的结构就映射到了VNode上面，就和我们真正拿到Dom节点的结构差不多，这个时候把VNode转化为JSON，设置成为小程序页面的data；现在的问题就是怎么把这个data转化为对应的小程序视图，这个remax会构建这么一个东西基础的模板")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("block")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("a:")]),t._v("for")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v("{{root.children}}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("a:")]),t._v("key")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v("{{item.id}}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  <template is={{'TPL_'+item.type}} data={{item}}  />\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("block")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("template")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("TPL_view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  <view class={{item.props['class']}}>\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("block")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("a:")]),t._v("for")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v("{{root.children}}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("a:")]),t._v("key")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v("{{item.id}}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      <template is={{'TPL_'+item.type}} data={{item}}  />\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("block")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("view")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("这样，就会可以处理动态的data数据到视图层的展现了；这样你的什么ts、css预处理是不是都可以很欢乐的用起来，react的hooks是不是也可以很欢快的用起来")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("taro2")])])]),t._v(" "),a("p",[t._v("一般呢，前端的世界就和这个江湖一样，"),a("strong",[t._v("乱烘烘你方唱罢我登场，反认他乡是故乡。甚荒唐，到头来都是为他人作嫁衣裳。")])]),t._v(" "),a("p",[t._v("​\t我们上面聊了taro之前的方式是静态编译的一个过程，真正运行时是小程序自己的运行时；但是对于上面的两个mpvue和remax这两个框架的思路，对于taro2就出来了新的改造，既然我们上面聊了，不管是vue和react，都是最后自己的运行时再配上对应的端容器，比如我们的web端的dom；")]),t._v(" "),a("p",[t._v("​\t那么对于这种情况，taro的思想就和remax的思想大致相同了，做一个运行时的对接层，taro-next来模拟dom 运行环境，最后通过setData来触发视图的更新；对于Vue和React这种框架，在开发的时候可能比较大差距，渲染最后的操作都大致相同，比较大的区别是声明周期的不同的对齐；")]),t._v(" "),a("p",[t._v("所以在taro-next里面也会有对应的生命周期的一些对齐；")]),t._v(" "),a("p",[t._v("目前整体而言，taro-next的柯力化比较细，事件机制也做的不错，比如直接有document.getElementById();")]),t._v(" "),a("p",[t._v("这个大思路其实就是模拟一个dom的影响环境，最后把dom对应映射到小程序；")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("kbone")])])]),t._v(" "),a("p",[t._v("最后还有一个官方出的kbone也是大致的思路，一个致力于微信小程序和 Web 端同构的解决方案。")]),t._v(" "),a("p",[t._v("实现了一个适配器，在适配层里模拟出了浏览器环境，让 Web 端的代码可以不做什么改动便可运行在小程序里。 Vue、React、Preact 等。都可以运行；")]),t._v(" "),a("p",[t._v("适配器提供的也是一个dom运行环境，dom、bom的api，不过他在视图层的组件实现是使用的小程序的自定义组件的方式，通过自定义组件来描述一棵树；可以看一下这个"),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/",target:"_blank",rel:"noopener noreferrer"}},[t._v("自定义组件的用法"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[t._v("#")]),t._v(" 最后")]),t._v(" "),a("p",[t._v("小程序实际就是一个性能比较好的hybrid")])])}),[],!1,null,null,null);s.default=e.exports}}]);