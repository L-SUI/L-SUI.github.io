(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{422:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"小程序分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序分析"}},[t._v("#")]),t._v(" 小程序分析")]),t._v(" "),a("h2",{attrs:{id:"小程序与普通网页开发的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序与普通网页开发的区别"}},[t._v("#")]),t._v(" 小程序与普通网页开发的区别")]),t._v(" "),a("p",[t._v("小程序的主要开发语言是 JavaScript ，小程序的开发同普通的网页开发相比有很大的相似性。对于前端开发者而言，从网页开发迁移到小程序的开发成本并不高，但是二者还是有些许区别的。")]),t._v(" "),a("p",[t._v("网页开发渲染线程和脚本线程是互斥的，这也是为什么长时间的脚本运行可能会导致页面失去响应，而在小程序中，二者是分开的，分别运行在不同的线程中。网页开发者可以使用到各种浏览器暴露出来的 DOM API，进行 DOM 选中和操作。而如上文所述，小程序的逻辑层和渲染层是分开的，逻辑层运行在 JSCore 中，并没有一个完整浏览器对象，因而缺少相关的DOM API和BOM API。这一区别导致了前端开发非常熟悉的一些库，例如 jQuery、 Zepto 等，在小程序中是无法运行的。同时 JSCore 的环境同 NodeJS 环境也是不尽相同，所以一些 NPM 的包在小程序中也是无法运行的。")]),t._v(" "),a("p",[t._v("网页开发者需要面对的环境是各式各样的浏览器，PC 端需要面对 IE、Chrome、QQ浏览器等，在移动端需要面对Safari、Chrome以及 iOS、Android 系统中的各式 WebView 。而小程序开发过程中需要面对的是两大操作系统 iOS 和 Android 的微信客户端，以及用于辅助开发的小程序开发者工具，小程序中三大运行环境也是有所区别的")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("运行环境")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("逻辑层")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("渲染层")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("iOS")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("JavaScriptCore")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("WKWebView")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("安卓")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("V8")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("chromium定制内核")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("小程序开发者工具")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("NWJS")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Chrome WebView")])])])]),t._v(" "),a("p",[t._v("网页开发者在开发网页的时候，只需要使用到浏览器，并且搭配上一些辅助工具或者编辑器即可。小程序的开发则有所不同，需要经过申请小程序帐号、安装小程序开发者工具、配置项目等等过程方可完成。")]),t._v(" "),a("h2",{attrs:{id:"文章分享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文章分享"}},[t._v("#")]),t._v(" 文章分享")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://chris118.github.io/2018/04/10/2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("小程序架构"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://eux.baidu.com/blog/fe/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信小程序架构原理"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://zhaomenghuan.js.org/blog/what-is-emp.html#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84",target:"_blank",rel:"noopener noreferrer"}},[t._v("基于vuejs的小程序引擎底层框架实现"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://zhaomenghuan.js.org/note/miniprogram/awesome-miniprogram.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("小程序原理等文章"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"拓展"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拓展"}},[t._v("#")]),t._v(" 拓展")]),t._v(" "),a("p",[t._v("Flutter 自己实现了一套渲染机制")]),t._v(" "),a("p",[t._v("小程序是语言层面的")]),t._v(" "),a("h2",{attrs:{id:"思维引导"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思维引导"}},[t._v("#")]),t._v(" 思维引导")]),t._v(" "),a("p",[a("strong",[t._v("首先我们看看小程序代码的组成部分")])]),t._v(" "),a("p",[t._v("js 开发逻辑代码  ==> js   ==>v8")]),t._v(" "),a("p",[t._v("wxss 控制小程序样式  ==>css(浏览器渲染器) ==>  css")]),t._v(" "),a("p",[t._v("wxml    xml  控制渲染层展示  ==>html(浏览器渲染器)==>dom")]),t._v(" "),a("p",[a("strong",[t._v("我们需要思考一个问题：")])]),t._v(" "),a("p",[t._v("wxss wxml 自己实现了一套渲染解析器还是使用了预编译技术？？   ===>html css")]),t._v(" "),a("h2",{attrs:{id:"基本架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本架构"}},[t._v("#")]),t._v(" 基本架构")]),t._v(" "),a("p",[t._v("原因：是对浏览器部分进行的优化，浏览器解析网页的时候是单线程的阻塞式的。")]),t._v(" "),a("p",[t._v("小程序主要分为"),a("strong",[t._v("逻辑层")]),t._v("和"),a("strong",[t._v("视图层")]),t._v("，还有就是他们的原生部分。这样组成了小程序的双线程架构，逻辑层加载js ，渲染层加载wxml、wxss==>iframe。通过JSBridge进行消息通信，只传输字符串类型的数据，例如点击事件会传输事件名。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/structure.png",alt:"structure"}})]),t._v(" "),a("ul",[a("li",[a("p",[t._v("视图层主要负责页面的渲染")])]),t._v(" "),a("li",[a("p",[t._v("逻辑层负责js的执行。")])])]),t._v(" "),a("p",[t._v("他们之间通过event和data来通信。通信是有微信客户端（native）做的一层中转；")]),t._v(" "),a("p",[t._v("然后也可以通过jsBridge来调用原生的api，比如什么相机、扫码等功能。")]),t._v(" "),a("p",[t._v("这个视图层，最后我们打包出来的代码，就是html和css，在这里面运行，视图层目前使用 WebView 作为渲染载体。")]),t._v(" "),a("p",[t._v("逻辑层是由独立的 JsCore 作为js的运行环境,所以他和浏览器不一样，只有一些js对应的方法，不能直接操作dom和获取dom，中间都需要通信这一层中转，在架构上，WebView 和 JavascriptCore 都是独立的模块，并不具备数据直接共享的通道。")]),t._v(" "),a("p",[t._v("当前，视图层和逻辑层的数据传输，实际上通过两边提供的 "),a("code",[t._v("evaluateJavascript")]),t._v(" 所实现。")]),t._v(" "),a("p",[t._v("即用户传输的数据，需要将其转换为字符串形式传递，同时把转换后的数据内容拼接成一份 JS 脚本，再通过执行 JS 脚本的形式传递到两边独立环境。")]),t._v(" "),a("p",[t._v("而 "),a("code",[t._v("evaluateJavascript")]),t._v(" 的执行会受很多方面的影响，数据到达视图层并不是实时的。")]),t._v(" "),a("p",[t._v("由于这之间他们是彼此独立的，是基于消息驱动来渲染的，所以不会阻塞页面；")]),t._v(" "),a("p",[t._v("所以这就不会造成渲染的阻塞，我的渲染不会影响你的js逻辑，js的执行也不会柱塞渲染的过程；")]),t._v(" "),a("p",[t._v("比如你在发送一些请求的时候，这种一般是经由native转发；")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/basicStructure.png",alt:"basicStructure"}})]),t._v(" "),a("h2",{attrs:{id:"查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看"}},[t._v("#")]),t._v(" 查看")]),t._v(" "),a("h3",{attrs:{id:"打开调试工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打开调试工具"}},[t._v("#")]),t._v(" 打开调试工具")]),t._v(" "),a("p",[t._v("微信开发者工具 ==> 左上角 调试--》调试微信开发者工具")]),t._v(" "),a("p",[a("strong",[t._v("查看页面")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementsByTagName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webview'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showDevTools")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("strong",[t._v("查看逻辑层")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603266403016_85AC96F4-C7E1-4F7F-BDAE-191375A9F1FA.png",alt:"1603266403016_85AC96F4-C7E1-4F7F-BDAE-191375A9F1FA"}})]),t._v(" "),a("p",[t._v("整个小程序--\x3e 只有一个逻辑层--\x3e装载所有页面逻辑js")]),t._v(" "),a("p",[t._v("视图层（渲染）==>一个页面---\x3e一个webview（wxml、wxss）")]),t._v(" "),a("h3",{attrs:{id:"小程序限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序限制"}},[t._v("#")]),t._v(" 小程序限制")]),t._v(" "),a("p",[t._v("小程序刚出来时候有限制5个层级，这是因为只维护了5层。现在是10层。")]),t._v(" "),a("h2",{attrs:{id:"基础库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础库"}},[t._v("#")]),t._v(" 基础库")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603266687632_3CF9F2DB-28DA-49DB-8554-9261F114F86D.png",alt:"1603266687632_3CF9F2DB-28DA-49DB-8554-9261F114F86D"}})]),t._v(" "),a("h3",{attrs:{id:"查看-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看-2"}},[t._v("#")]),t._v(" 查看")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603266794627_D5DDEB42-C471-45EB-9195-5229B47CCA27.png",alt:"1603266794627_D5DDEB42-C471-45EB-9195-5229B47CCA27"}})]),t._v(" "),a("h3",{attrs:{id:"小程序底层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序底层"}},[t._v("#")]),t._v(" 小程序底层")]),t._v(" "),a("p",[t._v("小程序开发者工具  openVendor==> 基础库（对于底层运行时的封装、提供事件、数据变更、通信、基础函数）")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603266951035_76BEFD4C-4205-46F1-9E0D-CF05E6583D2C.png",alt:"1603266951035_76BEFD4C-4205-46F1-9E0D-CF05E6583D2C"}})]),t._v(" "),a("p",[t._v("基础库==>wxappUnpacker==>破解.wxvpkg文件，查看源码(比较难读)")]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603267418231_B6E4E86E-17AA-4266-8306-80CCF868E056.png",alt:"1603267418231_B6E4E86E-17AA-4266-8306-80CCF868E056"}})]),t._v(" "),a("h2",{attrs:{id:"源码解读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码解读"}},[t._v("#")]),t._v(" 源码解读")]),t._v(" "),a("h3",{attrs:{id:"视图层引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视图层引擎"}},[t._v("#")]),t._v(" 视图层引擎")]),t._v(" "),a("p",[t._v("WAWebview.js  ==>视图层引擎")]),t._v(" "),a("blockquote",[a("p",[t._v("Foundation 基础模块\n提供环境变量env isService isWebview  eventEmit  jsbridge ready监听 配置")])]),t._v(" "),a("blockquote",[a("p",[t._v("WeixinJSBridge 消息通信机制")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/sourceCode/applets/1603268130898_BCC606C0-4253-418F-AF98-E60CA805CE6C.png",alt:"1603268130898_BCC606C0-4253-418F-AF98-E60CA805CE6C"}})]),t._v(" "),a("p",[t._v("NativeBuffer 转换数据格式")]),t._v(" "),a("p",[t._v("Reporter 日志系统")]),t._v(" "),a("p",[a("strong",[t._v("exparser 组件系统")])]),t._v(" "),a("ol",[a("li",[t._v("shadomDOM  （WebComponet规范）例子 wx-element")]),t._v(" "),a("li",[t._v("提供友好交互的组件  承接原生")]),t._v(" "),a("li",[t._v("video 原生的组件  事件系统")]),t._v(" "),a("li",[t._v("wxml")]),t._v(" "),a("li",[t._v("picker")]),t._v(" "),a("li",[t._v("slider")]),t._v(" "),a("li",[t._v("swiper")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exparser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerBehavior")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  is"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wx-class-prefix"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("created")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_classPrefix "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ownerShadowRoot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPrefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_classPrefix "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_addGlobalClass "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAddOriginalClass")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  methods"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("convertClassListWithPrefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getClassPrefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAddGlobalClass")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" o "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" o "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" o"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("convertClassWithPrefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getClassPrefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAddGlobalClass")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" e\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getClassPrefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_classPrefix\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getAddGlobalClass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_addGlobalClass\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br")])]),a("p",[a("strong",[a("strong",[t._v("virtualDOM")])])]),t._v(" "),a("h3",{attrs:{id:"逻辑层引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#逻辑层引擎"}},[t._v("#")]),t._v(" 逻辑层引擎")]),t._v(" "),a("p",[t._v("WAService.js  ==>")]),t._v(" "),a("blockquote",[a("p",[t._v("foundation 基础模块\n提供环境变量env isService isWebview  eventEmit  jsbridge ready监听 配置")])]),t._v(" "),a("blockquote",[a("p",[t._v("WeixinJSBridge 消息通信机制")])]),t._v(" "),a("p",[t._v("​    路由管理\n​    生命周期管理\n​    "),a("strong",[a("strong",[a("strong",[t._v("subContextEngine")])])]),t._v("__: App、Page、component  getApp"),a("br"),t._v("\n​    __"),a("strong",[a("strong",[t._v("virtualDOM")])])]),t._v(" "),a("blockquote",[a("p",[t._v("逻辑层维护了一套______virtualDOM______ 是为了可以选择节点，createSelectorQuery这个方法，中间还处理了时间的分发等等。")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("createSelectorQuery"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" __appServiceSDK__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_createSelectorQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("me")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("we")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("in")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("J")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"createSelectorQuery"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("h2",{attrs:{id:"编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[t._v("#")]),t._v(" 编译")]),t._v(" "),a("h3",{attrs:{id:"wcc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wcc"}},[t._v("#")]),t._v(" wcc")]),t._v(" "),a("p",[t._v("Wechat WXML Compiler ==> wxml编译器==> js")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("初始化，执行js，生成构建虚拟dom的函数(渲染器)")])]),t._v(" "),a("li",[a("p",[t._v("数据传递给 虚拟dom的函数==>vDOM描述")])]),t._v(" "),a("li",[a("p",[t._v("vDOM描述==>exparser==>解析 ==>构建真实dom")])]),t._v(" "),a("li",[a("p",[t._v("数据变更 2-3->diff--\x3e渲染")])])]),t._v(" "),a("p",[t._v("渲染==>WXWebview")]),t._v(" "),a("h3",{attrs:{id:"wcsc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wcsc"}},[t._v("#")]),t._v(" wcsc")]),t._v(" "),a("p",[t._v("WeChat Stylesheet Compiler ==>wxss编译器==>js")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("wxss ==>js (把rpx单位处理，处理成函数)")])]),t._v(" "),a("li",[a("p",[t._v("获取手机物理及像素分辨力来计算应该多少，")])]),t._v(" "),a("li",[a("p",[t._v("生成新的style 插入")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);