<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>性能优化篇(一) | Memory space</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="记忆空间">
    <link rel="preload" href="/assets/css/0.styles.7d2c80c1.css" as="style"><link rel="preload" href="/assets/js/app.66912e87.js" as="script"><link rel="preload" href="/assets/js/2.57d64b7f.js" as="script"><link rel="preload" href="/assets/js/46.4553d785.js" as="script"><link rel="prefetch" href="/assets/js/10.38a80cb0.js"><link rel="prefetch" href="/assets/js/11.b336f7a2.js"><link rel="prefetch" href="/assets/js/12.67247550.js"><link rel="prefetch" href="/assets/js/13.c36a7d24.js"><link rel="prefetch" href="/assets/js/14.8547e8bd.js"><link rel="prefetch" href="/assets/js/15.05ec817c.js"><link rel="prefetch" href="/assets/js/16.c922f152.js"><link rel="prefetch" href="/assets/js/17.028bbe7b.js"><link rel="prefetch" href="/assets/js/18.0ba25647.js"><link rel="prefetch" href="/assets/js/19.e9bf46ad.js"><link rel="prefetch" href="/assets/js/20.fdebeb43.js"><link rel="prefetch" href="/assets/js/21.2ba04073.js"><link rel="prefetch" href="/assets/js/22.98c3ec5d.js"><link rel="prefetch" href="/assets/js/23.f86a7565.js"><link rel="prefetch" href="/assets/js/24.970036b5.js"><link rel="prefetch" href="/assets/js/25.0177ccb8.js"><link rel="prefetch" href="/assets/js/26.764c191c.js"><link rel="prefetch" href="/assets/js/27.c392cd65.js"><link rel="prefetch" href="/assets/js/28.c80d9992.js"><link rel="prefetch" href="/assets/js/29.8e6ceff0.js"><link rel="prefetch" href="/assets/js/3.af448321.js"><link rel="prefetch" href="/assets/js/30.73d17fef.js"><link rel="prefetch" href="/assets/js/31.023c17d3.js"><link rel="prefetch" href="/assets/js/32.7bff88d8.js"><link rel="prefetch" href="/assets/js/33.d65d9299.js"><link rel="prefetch" href="/assets/js/34.4e9bf12c.js"><link rel="prefetch" href="/assets/js/35.c4ceb21c.js"><link rel="prefetch" href="/assets/js/36.a783db97.js"><link rel="prefetch" href="/assets/js/37.4064a22e.js"><link rel="prefetch" href="/assets/js/38.5800a4d9.js"><link rel="prefetch" href="/assets/js/39.304d82a4.js"><link rel="prefetch" href="/assets/js/4.20b02587.js"><link rel="prefetch" href="/assets/js/40.4a267169.js"><link rel="prefetch" href="/assets/js/41.919e4e23.js"><link rel="prefetch" href="/assets/js/42.d3fd7ad8.js"><link rel="prefetch" href="/assets/js/43.6ffbf57a.js"><link rel="prefetch" href="/assets/js/44.2522f5c8.js"><link rel="prefetch" href="/assets/js/45.6f508519.js"><link rel="prefetch" href="/assets/js/47.535b9fb7.js"><link rel="prefetch" href="/assets/js/48.807eff16.js"><link rel="prefetch" href="/assets/js/49.ce1d58de.js"><link rel="prefetch" href="/assets/js/5.7aabaed2.js"><link rel="prefetch" href="/assets/js/50.b2e59a62.js"><link rel="prefetch" href="/assets/js/51.cc5aa77b.js"><link rel="prefetch" href="/assets/js/6.5676bd56.js"><link rel="prefetch" href="/assets/js/7.105e6cdb.js"><link rel="prefetch" href="/assets/js/8.b168a075.js"><link rel="prefetch" href="/assets/js/9.299dbef1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7d2c80c1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Memory space</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/L-SUI/note/tree/master/every" target="_blank" rel="noopener noreferrer" class="nav-link external">
  每日
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/L-SUI/note/tree/master/LeetCode/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/L-SUI/note" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/L-SUI/note/tree/master/every" target="_blank" rel="noopener noreferrer" class="nav-link external">
  每日
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/L-SUI/note/tree/master/LeetCode/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/L-SUI/note" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>TypeScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/typescript/recursive_optimization.html" class="sidebar-link">递归优化</a></li><li><a href="/note/typescript/functional_programming.html" class="sidebar-link">函数式编程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/node/node.html" class="sidebar-link">NodeJS 初探</a></li><li><a href="/note/node/pm2.html" class="sidebar-link">PM2</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTTP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/http/http_1.html" class="sidebar-link">HTTP 1.x</a></li><li><a href="/note/http/http_2.html" class="sidebar-link">HTTP 2/3 &amp; HTTPS</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/linux/linux.html" class="sidebar-link">Linux 初探</a></li><li><a href="/note/linux/linux_deploy.html" class="sidebar-link">Linux 部署/配置</a></li><li><a href="/note/linux/linux_centos.html" class="sidebar-link">CentOS 7</a></li><li><a href="/note/linux/BasicCommand.html" class="sidebar-link">基本命令</a></li><li><a href="/note/linux/linux免密登陆.html" class="sidebar-link">Linux免密远程登录</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>OS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/os/thread.html" class="sidebar-link">进程、线程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/python/python爬虫.html" class="sidebar-link">爬取数据</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/java/java.html" class="sidebar-link">Java 初探</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/nginx/nginx.html" class="sidebar-link">Nginx 初探</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>项目工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/engineering/ci_cd.html" class="sidebar-link">前端工程化 CI/CD 初探</a></li><li><a href="/note/engineering/sonar.html" class="sidebar-link">Sonar &amp; SonarScanner</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/mysql/mysql.html" class="sidebar-link">Mysql 初探</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>常用工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/mac/command_line.html" class="sidebar-link">一些 mac 常用的命令</a></li><li><a href="/note/mac/homebrew.html" class="sidebar-link">homebrew</a></li><li><a href="/note/mac/nvm.html" class="sidebar-link">nvm 安装以及使用</a></li><li><a href="/note/node/nrm.html" class="sidebar-link">nrm 安装以及使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>自动化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/automation/jenkins.html" class="sidebar-link">Jenkins笔记</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/jsNote/base/函数柯里化curry.html" class="sidebar-link">函数柯里化</a></li><li><a href="/note/jsNote/base/继承.html" class="sidebar-link">继承</a></li><li><a href="/note/jsNote/base/使用setTimeout模拟setInterval.html" class="sidebar-link">使用setTimeout模拟setInterval</a></li><li><a href="/note/jsNote/base/手写防抖(Debouncing)和节流(throttling).html" class="sidebar-link">手写防抖(Debouncing)和节流(throttling)</a></li><li><a href="/note/jsNote/base/手写实现拖拽.html" class="sidebar-link">手写实现拖拽</a></li><li><a href="/note/jsNote/base/手写实现Object.create.html" class="sidebar-link">手写实现Object.create</a></li><li><a href="/note/jsNote/base/手写一个call或apply.html" class="sidebar-link">手写一个call或apply</a></li><li><a href="/note/jsNote/base/手写一个Function.bind.html" class="sidebar-link">手写一个Function.bind</a></li><li><a href="/note/jsNote/base/手写一个instanceOf原理.html" class="sidebar-link">手写一个instanceOf原理</a></li><li><a href="/note/jsNote/base/手写一个JS深拷贝(由浅入深多种解法).html" class="sidebar-link">手写一个JS深拷贝(由浅入深多种解法)</a></li><li><a href="/note/jsNote/base/手写一个JSON.parse和JSOn.stringify.html" class="sidebar-link">手写一个JSON.parse和JSOn.stringify</a></li><li><a href="/note/jsNote/base/手写一个map和reduce.html" class="sidebar-link">手写一个map和reduce</a></li><li><a href="/note/jsNote/base/手写一个new操作符.html" class="sidebar-link">手写一个new操作符</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>QA相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/QA/JavaScript&amp;QA.html" class="sidebar-link">javascript &amp; QA</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>性能优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/optimization/性能优化一.html" class="active sidebar-link">性能优化篇(一)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/optimization/性能优化一.html#为什么要进行性能优化" class="sidebar-link">为什么要进行性能优化?</a></li><li class="sidebar-sub-header"><a href="/note/optimization/性能优化一.html#性能优化学徒工" class="sidebar-link">性能优化学徒工</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/optimization/性能优化一.html#雅⻁军规践行" class="sidebar-link">雅⻁军规践行</a></li><li class="sidebar-sub-header"><a href="/note/optimization/性能优化一.html#缓存的优先级" class="sidebar-link">缓存的优先级</a></li><li class="sidebar-sub-header"><a href="/note/optimization/性能优化一.html#网站协议" class="sidebar-link">网站协议</a></li><li class="sidebar-sub-header"><a href="/note/optimization/性能优化一.html#多普勒测速" class="sidebar-link">多普勒测速</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/optimization/性能优化一.html#渲染中性能优化" class="sidebar-link">渲染中性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/optimization/性能优化一.html#css是否会引起重排和重绘" class="sidebar-link">css是否会引起重排和重绘</a></li><li class="sidebar-sub-header"><a href="/note/optimization/性能优化一.html#css和js会阻塞页面解析渲染吗" class="sidebar-link">css和js会阻塞页面解析渲染吗</a></li></ul></li></ul></li><li><a href="/note/optimization/性能优化二.html" class="sidebar-link">性能优化篇(二)</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="性能优化篇-一"><a href="#性能优化篇-一" class="header-anchor">#</a> 性能优化篇(一)</h1> <h2 id="为什么要进行性能优化"><a href="#为什么要进行性能优化" class="header-anchor">#</a> 为什么要进行性能优化?</h2> <ul><li><p>57%的用户更在乎网⻚在3秒内是否完成加载。</p></li> <li><p>52%的在线用户认为网⻚打开速度影响到他们对网站的忠实度。</p></li> <li><p>每慢1秒造成⻚面 PV 降低11%，用户满意度也随之降低降低16%。</p></li> <li><p>近半数移动用户因为在10秒内仍未打开⻚面从而放弃。</p> <p><a href="https://www.cdnetworks.com/resources/whitepapers/us/Global%20Web%20Performance%20Matters.pdf" target="_blank" rel="noopener noreferrer">性能优化白皮书<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h2 id="性能优化学徒工"><a href="#性能优化学徒工" class="header-anchor">#</a> 性能优化学徒工</h2> <ul><li>雅⻁军规</li> <li>缓存策略</li> <li>网站协议</li> <li>小字为先</li></ul> <h3 id="雅⻁军规践行"><a href="#雅⻁军规践行" class="header-anchor">#</a> 雅⻁军规践行</h3> <p><img src="/optimization/yahu.png" alt="/optimization/yahu.png"></p> <ul><li>浏览器正常并发script请求5个左右，大小100k左右，压缩后30k</li> <li>CDN，使用CDN是因为不会携带多余的cookie。使用多个CDN，解决浏览器对同一个域名的并发。</li></ul> <h3 id="缓存的优先级"><a href="#缓存的优先级" class="header-anchor">#</a> 缓存的优先级</h3> <p>cache-control--expires--etag--last-modified</p> <p><strong>etag / if-none-match</strong></p> <p>这也是一组请求/相应头 响应头:
etag: &quot;D5FC8B85A045FF720547BC36FC872550&quot; 请求头:
if-none-match: &quot;D5FC8B85A045FF720547BC36FC872550&quot;</p> <p>原理类似，服务器端返回资源时，如果头部带上了 etag，那么资源下 次请求时就会把值加入到请求头 if-none-match 中，服务器可以对比 这个值，确定资源是否发生变化，如果没有发生变化，则返回 304。</p> <p><strong>last-modified / if-modified-since</strong></p> <p>这是一组请求/相应头</p> <p>响应头:</p> <p>* last-modified: Wed, 16 May 2018 02:57:16 GMT 01 请求头:</p> <p>if-modified-since: Wed, 16 May 2018 05:55:38 GMT</p> <p>服务器端返回资源时，如果头部带上了 last-modified，那么 资源下次请求时就会把值加入到请求头 if-modified-since 中，服务器可以对比这个值，确定资源是否发生变化，如果 没有发生变化，则返回 304。</p> <p><strong>expires</strong></p> <p>* expires: Thu, 16 May 2019 03:05:59 GMT
在 http 头中设置一个过期时间，在这个过期时间之前，浏览器的请求都不会发出，而是</p> <p>自动从缓存中读取文件，除非缓存被清空，或者强制刷新。缺陷在于，服务器时间和用 户端时间可能存在不一致，所以 HTTP/1.1 加入了 cache-control 头来改进这个问题。</p> <p><strong>cache-control</strong></p> <p><strong>HTTP</strong>强缓</p> <p>设置过期的时间⻓度(秒)，在这个时间范围内，浏览器请求都会直 接读缓存。当 expires 和 cache-control 都存在时，cache-control 的 优先级更高。</p> <p><img src="/optimization/cache.png" alt=""></p> <p><strong>举个例子：</strong></p> <ol><li>常用的库  jquery	http强缓存，对版本的要求不是很严格，只需要跟服务器校验</li> <li>业务代码 本地缓存  MD5变化非常频繁   http-&gt;缓存失败
<ol><li>localstorage  5M</li> <li>web SQL    50M  （前端ORM存储方案     库<strong>localForage</strong>）</li> <li>启动文件：查看本地是否有这个缓存的js</li> <li>有 ：先判断是否过期
<ol><li>已过期：删除两个key的值，拉取js文件 请求etag，请求js，增加两个key code</li> <li>没过期： 直接取缓存的代码 （eval、addScript）</li></ol></li> <li>没有： 直接拉取js，请求js，增加两个key code</li></ol></li></ol> <h3 id="网站协议"><a href="#网站协议" class="header-anchor">#</a> 网站协议</h3> <p>浏览器请求//xx.cn/a.js--&gt;解析域名—&gt;HTTP连接—&gt;服务器处理文件—&gt;返回数据--&gt;浏览器解析、渲染文件。</p> <p><img src="/optimization/http.png" alt=""></p> <p>Keep-Alive解决的核心问 题就在此，一定时间内，同一域名多次请求数据，只建立一次HTTP请求，其他请求可复用每一次建立的连接通道，以达到提高请求 效率的问题。一定时间是可以配置的，HTTP1.1还是存在效率问题，第一个:串行的文件传输。第二个:连接数过多。HTTP/2对同一 域名下所有请求都是基于流，也就是说同一域名不管访问多少文件，也只建立一路连接。同样Apache的最大连接数为300，因为有了 这个新特性，最大的并发就可以提升到300，比原来提升了6倍!</p> <h3 id="多普勒测速"><a href="#多普勒测速" class="header-anchor">#</a> 多普勒测速</h3> <p><em>分五次请求，计算公式</em></p> <ol><li>api?http1.0&amp;t=1&amp;size=0k</li> <li>api?http1.1&amp;t=2&amp;size=0k</li> <li>api?http1.1&amp;t=3&amp;size=0k</li> <li>api?http1.1&amp;t=4&amp;size=10k</li> <li>api?http1.1&amp;t=5&amp;size=40k</li></ol> <ul><li>T1 = DNS+New Connection+RTT</li> <li>T2 = New Connection+RTT</li> <li>T3 = RTT</li> <li>10k/(t4-t3)~TCP bandwidth</li> <li>(40k-10k)/(t5-t4)~TCP bandwidth</li></ul> <h2 id="渲染中性能优化"><a href="#渲染中性能优化" class="header-anchor">#</a> 渲染中性能优化</h2> <ul><li>重绘影响</li> <li>如何规避</li> <li>重排影响</li> <li>高效渲染</li></ul> <h3 id="css是否会引起重排和重绘"><a href="#css是否会引起重排和重绘" class="header-anchor">#</a> css是否会引起重排和重绘</h3> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">.box</span> <span class="token punctuation">{</span>
            <span class="token property">width</span><span class="token punctuation">:</span>100px<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
            <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>
            <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
            <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
            <span class="token property">animation</span><span class="token punctuation">:</span> cicleBox 2s infinite<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token atrule"><span class="token rule">@keyframes</span> cicleBox</span> <span class="token punctuation">{</span>
            <span class="token selector">0%</span> <span class="token punctuation">{</span>
                <span class="token comment">/* top: 0;
                left: 0; */</span>
                <span class="token property">transform</span><span class="token punctuation">:</span><span class="token function">translate</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token selector">25%</span> <span class="token punctuation">{</span>
                <span class="token comment">/* top: 0;
                left: 200px; */</span>
                <span class="token property">transform</span><span class="token punctuation">:</span><span class="token function">translate</span><span class="token punctuation">(</span>200px<span class="token punctuation">,</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token selector">50%</span> <span class="token punctuation">{</span>
                <span class="token comment">/* top: 200px;
                left: 200px; */</span>
                <span class="token property">transform</span><span class="token punctuation">:</span><span class="token function">translate</span><span class="token punctuation">(</span>200px<span class="token punctuation">,</span>200px<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token selector">75%</span> <span class="token punctuation">{</span>
                <span class="token comment">/* top: 200px;
                left: 0; */</span>
                <span class="token property">transform</span><span class="token punctuation">:</span><span class="token function">translate</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>200px<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><ul><li>上述代码中 使用top和left值进行变化时，会进行重排和重绘。</li> <li>上述代码中 使用transform进行变化时，不会进行重排和重绘。</li> <li>实际使用例子参考淘宝官网轮播图</li></ul> <p>**结论：**css是否会引起重排和重绘，取决于代码的书写。</p> <p><strong>分析：</strong></p> <div class="language- extra-class"><pre><code>1. 网页的渲染流程
  	1. 浏览器的dom是分层的，网页是3D的。
  	2. 对DOM元素节点计算样式结果Recalculate Style样式重计算
  	3. 为每个节点生成图形位置Layout回流重排
  	4. 将每个节点绘制填充到图层中Paint
  	5. 图层作为纹理上传到GPU
  	6. Composite Layers 合成层把符合图层生成到页面
  	7. Composite Layers 做了什么？
       	1. 图层的绘制列表，准备好，主线程 commit 合成线程
       	2. 合成线程 viewport rt 划分图块
       	3. 生成位图   栅格化（光栅化） raster
       	4. 所有图块 GPU合成生成DarwQuad提交给浏览器渲染进程
       	5. viz组件  接收到DarwQuad 绘制到我们的屏幕上
2. 分层
  	1. 根元素，position分层，transform，半透明，css滤镜，canvas，video，overflow
  	2. GPU硬件加速：CSS3D，video，webgl，transform，will-change:transform
3. 重绘和重排（盒子动了必定重排）
  	1. offset，scroll，client，width 读取   会打断浏览器工作。造成重排。
  	2. 优化： requestAnimationFrame 下一帧去写（react利用了他：设置dom元素，读写分离）
  	3. cpu负责操作系统和程序和数据处理
  	4. gpu负责显示 数据处理 效率更高
  	5. fastdom控制读写分离的插件
  	6. csstriggers.com可查看是否引起重排重绘
</code></pre></div><hr> <p>图片占位</p> <hr> <h3 id="css和js会阻塞页面解析渲染吗"><a href="#css和js会阻塞页面解析渲染吗" class="header-anchor">#</a> css和js会阻塞页面解析渲染吗</h3> <ol><li>js不会影响Dom解析，会影响Dom渲染</li> <li>css不会影响Dom解析，会影响Dom渲染</li> <li>css加载会阻塞后面的js语句</li> <li>css会影响DOM  ready吗？</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'不会'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>不会<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'会'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>会<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/L-SUI/note/edit/master/docs/note/optimization/性能优化一.md" target="_blank" rel="noopener noreferrer">在 Github 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">7/24/2020, 2:36:50 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/QA/JavaScript&amp;QA.html" class="prev">
        javascript &amp; QA
      </a></span> <span class="next"><a href="/note/optimization/性能优化二.html">
        性能优化篇(二)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.66912e87.js" defer></script><script src="/assets/js/2.57d64b7f.js" defer></script><script src="/assets/js/46.4553d785.js" defer></script>
  </body>
</html>
